# PRD: Telegram Mini App «Служба такси» — MVP

## Оригинальное ТЗ
Создание минимально жизнеспособного сервиса такси (MVP) для одного города, работающего внутри Telegram, с приёмом заказов через Mini App, распределением заказов через чат водителей и управлением через веб-админку.

## Технологический стек
- **Backend:** Python FastAPI + MongoDB
- **Frontend:** React 19 + Tailwind CSS + shadcn/ui
- **Telegram Integration:** python-telegram-bot + Webhook API

## Роли пользователей
1. **Клиент** — пользователь Telegram, оформляет заказы через Mini App
2. **Водитель** — получает заказы в чате, принимает через inline-кнопки
3. **Администратор** — управляет через веб-админку

## Статусы заказа
- NEW → BROADCAST → ASSIGNED → COMPLETED
- NEW/BROADCAST → CANCELLED

## Реализованные функции (08.02.2026)

### Mini App (Клиент)
- [x] Форма создания заказа (Откуда, Куда, Комментарий)
- [x] Просмотр статуса активного заказа
- [x] Отмена заказа с подтверждением
- [x] Информация о назначенном водителе (имя, телефон)
- [x] Polling обновлений статуса

### Telegram Bot
- [x] Рассылка заказов в чат водителей
- [x] Inline-кнопка "Принять заказ"
- [x] Anti-race защита при назначении
- [x] Автоматическая регистрация водителей
- [x] Кнопка завершения заказа для водителя
- [x] Уведомления клиенту о статусе

### Админ-панель
- [x] Авторизация через Telegram ID
- [x] Дашборд со статистикой
- [x] Управление заказами (просмотр, фильтры, отмена, назначение)
- [x] Управление водителями (блокировка, телефон)
- [x] Просмотр клиентов
- [x] Логи действий
- [x] Настройки (Chat ID водителей, Webhook URL)

### Backend API
- [x] /api/client/auth — авторизация клиента
- [x] /api/client/order — CRUD заказов клиента
- [x] /api/admin/auth — авторизация админа
- [x] /api/admin/orders — управление заказами
- [x] /api/admin/drivers — управление водителями
- [x] /api/admin/clients — список клиентов
- [x] /api/admin/logs — логи действий
- [x] /api/admin/stats — статистика
- [x] /api/telegram/webhook — webhook для бота

## Ограничения MVP (не реализовано)
- Онлайн-оплата
- Карты и геолокация
- Автоназначение
- Несколько городов
- Рейтинги и аналитика

## Настройка для работы

### 1. Telegram Bot Token
Уже настроен в /app/backend/.env

### 2. Chat ID водителей
1. Создайте группу в Telegram
2. Добавьте бота в группу (дайте права админа)
3. Узнайте Chat ID через @RawDataBot
4. Введите Chat ID в Настройках админки

### 3. Установка Webhook
```bash
curl -X POST "https://api.telegram.org/bot{TOKEN}/setWebhook?url={BACKEND_URL}/api/telegram/webhook"
```

## Backlog (P1/P2)
- P1: Интеграция с реальным Telegram Login Widget
- P1: История поездок клиента с деталями
- P2: Push-уведомления
- P2: Расчёт стоимости поездки
- P2: Интеграция карт (Яндекс/Google)

## Следующие шаги
1. Настроить webhook для Telegram бота
2. Создать группу водителей и указать Chat ID
3. Протестировать полный цикл заказа
